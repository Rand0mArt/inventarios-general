<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inventarios General</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
  </head>
  <body>
    <div class="bg-layer bg-layer-1"></div>
    <div class="bg-layer bg-layer-2"></div>

    <main class="app-shell">
      <section id="mainLayout" class="layout-grid">
        <aside id="inventoryPanel" class="panel glass">
          <div id="inventoryPanelToggle" class="inventory-panel-head">
            <h2>Inventarios</h2>
            <span id="inventoryPanelState">Expandido</span>
          </div>
          <form id="inventoryForm" class="stack">
            <label for="inventoryName">Nuevo inventario</label>
            <div class="row">
              <input id="inventoryName" type="text" placeholder="Ej. Almacén Central" required />
              <input id="inventoryColor" type="color" value="#1f7a8c" />
              <label class="file-chip" for="inventoryImage">Foto</label>
              <input id="inventoryImage" type="file" accept="image/*" />
              <button type="submit">Crear</button>
            </div>
          </form>
          <ul id="inventoryList" class="inventory-list"></ul>
        </aside>

        <section class="panel glass content">
          <div class="content-head">
            <h2 id="activeInventoryName">Selecciona un inventario</h2>
            <button id="addFieldBtnInline" type="button" class="ghost-btn">Agregar campo</button>
          </div>

          <div class="tools-row">
            <input id="searchInput" type="search" placeholder="Buscar producto o SKU..." />
            <button id="manageFieldsBtn" type="button">Configurar campos</button>
          </div>

          <div class="add-product-bar">
            <p id="skuPreview" class="sku-preview">Se generará al agregar.</p>
            <button id="openAddProductBtn" type="button" class="plus-btn">+ Agregar producto</button>
          </div>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>
                    <span id="thProduct">Producto</span>
                  </th>
                  <th>
                    <span id="thSku">SKU</span>
                  </th>
                  <th>
                    <span id="thQuantity">Cantidad</span>
                  </th>
                  <th>
                    <span id="thPrice">Precio</span>
                  </th>
                  <th>
                    <span id="thTotal">Total</span>
                  </th>
                  <th>
                    <span id="thActions">Acciones</span>
                  </th>
                </tr>
              </thead>
              <tbody id="itemsTableBody"></tbody>
            </table>
          </div>
        </section>
      </section>

      <section class="panel glass dashboard">
        <div class="dashboard-head">
          <h2>Dashboard</h2>
          <p id="dashboardInventoryTitle" class="subtitle">Métricas del inventario seleccionado.</p>
        </div>
        <div id="kpiWidgets" class="kpi-grid"></div>
        <div class="dashboard-grid">
          <article class="dash-card">
            <h3>Valor por producto</h3>
            <div id="valueChart" class="bar-chart"></div>
          </article>
          <article class="dash-card">
            <h3>Unidades por producto</h3>
            <div id="unitsChart" class="bar-chart"></div>
          </article>
          <article class="dash-card">
            <h3>Top productos por valor</h3>
            <div id="topProductsChart" class="bar-chart"></div>
          </article>
          <article class="dash-card">
            <h3>Historial (Entradas/Salidas)</h3>
            <div id="movementSummary" class="movement-summary"></div>
            <div id="movementHistory" class="movement-list"></div>
          </article>
        </div>
      </section>
    </main>

    <template id="inventoryItemTemplate">
      <li>
        <button type="button" class="inventory-pill">
          <span class="name"></span>
          <span class="meta"></span>
        </button>
      </li>
    </template>

    <dialog id="editProductDialog" class="app-dialog">
      <form id="editProductForm" class="dialog-form" method="dialog">
        <h3>Editar producto</h3>
        <input id="editProductId" type="hidden" />
        <div>
          <label for="editItemName">Nombre</label>
          <input id="editItemName" type="text" required />
        </div>
        <div>
          <label for="editItemSku">SKU</label>
          <input id="editItemSku" type="text" required />
        </div>
        <div>
          <label for="editItemQty">Cantidad</label>
          <input id="editItemQty" type="number" min="0" required />
        </div>
        <div>
          <label for="editItemPrice">Precio</label>
          <input id="editItemPrice" type="text" inputmode="decimal" required />
        </div>
        <div id="editDynamicFieldsContainer" class="dynamic-fields"></div>
        <div class="dialog-actions">
          <button id="deleteProductBtn" type="button" class="danger">Quitar</button>
          <button id="cancelEditProductBtn" type="button" class="ghost-btn">Cancelar</button>
          <button type="submit">Guardar</button>
        </div>
      </form>
    </dialog>

    <dialog id="tableConfigDialog" class="app-dialog">
      <form id="tableConfigForm" class="dialog-form" method="dialog">
        <h3>Configurar pestañas y campos</h3>
        <p class="subtitle">Ajusta los encabezados según tipo de inventario.</p>
        <div class="dialog-grid">
          <div>
            <label for="cfgProduct">Columna 1</label>
            <input id="cfgProduct" type="text" />
          </div>
          <div>
            <label for="cfgSku">Columna 2</label>
            <input id="cfgSku" type="text" />
          </div>
          <div>
            <label for="cfgQuantity">Columna 3</label>
            <input id="cfgQuantity" type="text" />
          </div>
          <div>
            <label for="cfgPrice">Columna 4</label>
            <input id="cfgPrice" type="text" />
          </div>
          <div>
            <label for="cfgTotal">Columna 5</label>
            <input id="cfgTotal" type="text" />
          </div>
          <div>
            <label for="cfgActions">Columna 6</label>
            <input id="cfgActions" type="text" />
          </div>
        </div>
        <h4>Campos personalizados</h4>
        <div class="field-creator">
          <input id="newFieldName" type="text" placeholder="Nombre del campo (ej. Estado)" />
          <select id="newFieldType">
            <option value="text">Texto</option>
            <option value="number">Número</option>
            <option value="date">Fecha</option>
            <option value="tel">Teléfono</option>
            <option value="time">Hora</option>
            <option value="duration">Duración</option>
            <option value="textarea">Texto largo</option>
          </select>
          <button id="addFieldBtn" type="button">Agregar campo</button>
        </div>
        <ul id="fieldsList" class="fields-list"></ul>
        <div class="dialog-actions">
          <button id="cancelConfigBtn" type="button" class="ghost-btn">Cancelar</button>
          <button type="submit">Guardar configuración</button>
        </div>
      </form>
    </dialog>

    <dialog id="editInventoryDialog" class="app-dialog">
      <form id="editInventoryForm" class="dialog-form" method="dialog">
        <h3>Editar inventario</h3>
        <div>
          <label for="editInventoryName">Nombre</label>
          <input id="editInventoryName" type="text" required />
        </div>
        <div>
          <label for="editInventoryColor">Color</label>
          <input id="editInventoryColor" type="color" />
        </div>
        <div>
          <label for="editInventoryImage">Foto</label>
          <input id="editInventoryImage" type="file" accept="image/*" />
        </div>
        <div class="dialog-actions">
          <button id="deleteInventoryBtn" class="danger" type="button">Eliminar</button>
          <button id="removeInventoryImageBtn" class="ghost-btn" type="button">Quitar foto</button>
          <button id="cancelEditInventoryBtn" type="button" class="ghost-btn">Cancelar</button>
          <button type="submit">Guardar</button>
        </div>
      </form>
    </dialog>

    <dialog id="addProductDialog" class="app-dialog">
      <form id="addProductForm" class="dialog-form" method="dialog">
        <h3>Agregar producto</h3>
        <div>
          <label for="addItemName">Nombre</label>
          <input id="addItemName" type="text" required />
        </div>
        <div>
          <label for="addItemSku">SKU</label>
          <input id="addItemSku" type="text" />
        </div>
        <div>
          <label for="addItemQty">Cantidad</label>
          <input id="addItemQty" type="number" min="0" value="0" required />
        </div>
        <div>
          <label for="addItemPrice">Precio</label>
          <input id="addItemPrice" type="text" inputmode="decimal" value="0.00" required />
        </div>
        <div id="addDynamicFieldsContainer" class="dynamic-fields"></div>
        <div class="dialog-actions">
          <button id="cancelAddProductBtn" type="button" class="ghost-btn">Cancelar</button>
          <button type="submit">Guardar</button>
        </div>
      </form>
    </dialog>

    <script src="app.js"></script>
  </body>
</html>
